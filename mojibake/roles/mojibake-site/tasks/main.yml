---

# TO DO: Investigate if this is necessary
- name: Change SELinux to allow Docker to connect to TCP sockets
  command: /usr/sbin/setsebool -P docker_connect_any 1

- name: make /var/www/defestri
  file: path=/var/www/defestri state=directory owner=www-data group=www-data mode=0755

- name: Pull down mojibake code to get the static files for nginx
  git: repo=https://github.com/ardinor/mojibake.git
       dest=/tmp/mojibake

- name: Move static files over to /var/www/defestri
  command: mv /tmp/mojibake/mojibake/static/ /var/www/defestri/static
  notify: restart nginx

- name: Remove unncessary mojibake code
  command: rm -rf /tmp/mojibake

# - name: Start volume container
#   docker: image=centos name=db-data volumes=/var/lib/mysql

# - name: Start MariaDB Container
#   docker: image=ardinor/centos-mariadb name=mojibake-db volumes_from=db-data
#           env="MYSQL_ROOT_PASSWORD={{ db_root_password }},
#                MYSQL_USER={{ db_user }},
#                MYSQL_PASSWORD={{ db_user_password }},
#                MYSQL_DATABASE={{ db_table }}"

# - name: Start Mojibake volume container
#   docker: image=centos name=mojibake-data volumes=/var/lib/mojibake

# - name: Start Mojibake Docker container
#   docker: image=ardinor/mojibake-python name=mojibake
#           ports=127.0.0.1:{{ mojibake_port }}:8000
#           links=mojibake-db:mojibake-db
#           volumes_from=mojibake-data
#           env="ADMIN_USER={{ admin_user }},
#                ADMIN_PASS={{ admin_pass }},
#                DB_USER={{ db_user }},
#                DB_PASS={{ db_user_password }}"
